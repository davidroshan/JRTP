package com.jrtp.officeportal.controller;

import java.util.List;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

import com.jrtp.officeportal.binding.DashboardResponse;
import com.jrtp.officeportal.service.EnquiryService;

@Controller
public class EnquiryController {
    
	@Autowired
	HttpSession session;
	
	@Autowired
	EnquiryService enqService;
	
	@GetMapping("/dashboard")
	public String dashboardPage(Model model) {
		
		Object obj =  session.getAttribute("userId");
        if(obj == null) {
        	return "login";
        }
		
		Integer userId = (Integer)obj;
		System.out.println("userId:"+userId);
		DashboardResponse dashboardResponse = enqService.getDashboardData(userId);
		model.addAttribute("dasboardData", dashboardResponse);
		return "dashboard";
	}
	
	@GetMapping("/enquiry")
	public String addEnquiryPage(Model model) {
		List<String> courses = enqService.getCourseNames();
		List<String> enquieyStatus = enqService.getEnqStatus();
		model.addAttribute("courses", courses);
		model.addAttribute("enqStatus", enquieyStatus);
		return "add-enquiry";
	}
	
	@GetMapping("/enquires")
	public String viewEnquiryPage() {
		return "view-enquires";
	}
	
	@GetMapping("/logout")
	public String logout() {
		session.invalidate();
		return "index";
	}
}
