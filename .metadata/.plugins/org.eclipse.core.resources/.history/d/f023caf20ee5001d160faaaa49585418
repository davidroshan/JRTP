package com.jrtp.officeportal.service.serviceimpl;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.jrtp.officeportal.binding.DashboardResponse;
import com.jrtp.officeportal.binding.EnquiryForm;
import com.jrtp.officeportal.binding.EnquirySearchCriteria;
import com.jrtp.officeportal.entity.CoursesEntity;
import com.jrtp.officeportal.entity.StudentEnquiryEntity;
import com.jrtp.officeportal.entity.UserDtlsEntity;
import com.jrtp.officeportal.repository.CourseRepo;
import com.jrtp.officeportal.repository.EnquiryStatusRepo;
import com.jrtp.officeportal.repository.UserDtlsRepo;
import com.jrtp.officeportal.service.EnquiryService;

@Service
public class EnquiryServiceImpl implements EnquiryService {
	
	@Autowired
	private UserDtlsRepo userRepository;
	
	@Autowired
	private CourseRepo cRepo;
	
	@Autowired
	private EnquiryStatusRepo eRepo;

	@Override
	public List<String> getCourseNames() {
		
		List<CoursesEntity> courseEntityList = cRepo.findAll();
		List<String> courses = new ArrayList<>();
		
		for(CoursesEntity entity:courseEntityList) {
			courses.add(entity.getCourseName());
		}
		return courses;
	}

	@Override
	public List<String> getEnqStatus() {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public DashboardResponse getDashboardData(Integer userId) {
		
		DashboardResponse dashboardResponse = new DashboardResponse();
		
		Optional<UserDtlsEntity> findById = userRepository.findById(userId);
		if(findById.isPresent()) {
			UserDtlsEntity user = findById.get();
			List<StudentEnquiryEntity> enquires = user.getEnquires();
			
			int totalEnquries = enquires.size();
			    
			int lostEnquiry = enquires.stream()	
			          .filter(enquiry->enquiry.getEnqStatus().equals("Lost"))
			          .collect(Collectors.toList()).size();
			
			int enrolledEnquiry = enquires.stream()
					.filter(enquiry->enquiry.getEnqStatus().equals("Enrolled"))
					.collect(Collectors.toList()).size();
			
			dashboardResponse.setTotalEnquires(totalEnquries);
			dashboardResponse.setLostCnt(lostEnquiry);
			dashboardResponse.setEnrolledCnt(enrolledEnquiry);
		}
		
		return dashboardResponse;
	}

	@Override
	public String upsertEnquiry(EnquiryForm enquiryForm) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public List<EnquiryForm> getEnquiries(Integer userId, EnquirySearchCriteria criteria) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public EnquiryForm getenquiry(Integer enqId) {
		// TODO Auto-generated method stub
		return null;
	}

}
